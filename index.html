<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ãƒ‘ãƒ¬ãƒƒãƒˆç©è¼‰ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ (v3.2 ã‚¹ãƒãƒ›å®Œå…¨ä¿®æ­£ç‰ˆ)</title>
    <style>
        /* --- åŸºæœ¬è¨­å®š (PCãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆ) --- */
        body { 
            font-family: "Helvetica Neue", Arial, sans-serif; 
            height: 100vh; width: 100vw; margin: 0; background: #e0e4e8; 
            overflow: hidden; /* ç”»é¢å…¨ä½“ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ç¦æ­¢ */
            display: flex;
        }
        
        h2 { margin: 0 0 5px 0; font-size: 15px; color: #2c3e50; border-bottom: 1px solid #ddd; padding-bottom: 5px; }
        .column-header { font-size: 11px; font-weight: bold; color: #7f8c8d; text-transform: uppercase; margin-bottom: 5px; display: block; margin-top: 10px;}
        
        button { cursor: pointer; border: 1px solid #ccc; background: #f8f9fa; border-radius: 4px; font-size: 13px; transition: all 0.1s; }
        button:hover { background: #e9ecef; }
        button:active { transform: translateY(1px); }

        input[type="number"] { width: 55px; padding: 4px; border: 1px solid #ccc; border-radius: 4px; text-align: right; font-size: 12px; }

        /* --- PCãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ (3ã‚«ãƒ©ãƒ ) --- */
        #left-col {
            width: 240px; min-width: 240px; background: #fff; border-right: 1px solid #ccc; padding: 15px;
            display: flex; flex-direction: column; gap: 5px; z-index: 10; overflow-y: auto;
        }

        #center-col {
            flex: 1;
            background: #cbd3da;
            position: relative;
            overflow: hidden; 
            display: flex; justify-content: center; align-items: center;
            padding: 60px 20px 20px 20px;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.1);
        }

        #right-col {
            width: 260px; min-width: 260px; background: #fff; border-left: 1px solid #ccc; padding: 15px;
            display: flex; flex-direction: column; gap: 8px; z-index: 10; overflow-y: auto;
        }

        /* --- ãƒ¢ãƒã‚¤ãƒ«ç”¨ã‚¿ãƒ– (PCã§ã¯éè¡¨ç¤º) --- */
        #mobile-tabs { display: none; }
        .mobile-only { display: none; }

        /* --- UIãƒ‘ãƒ¼ãƒ„ --- */
        .truck-btn { padding: 8px; text-align: left; display: flex; flex-direction: column; gap: 2px; width: 100%; margin-bottom: 3px; }
        .truck-btn strong { color: #333; font-size: 13px; }
        .truck-btn small { color: #666; font-size: 10px; }
        .truck-btn.active { background: #2c3e50; border-color: #1a252f; }
        .truck-btn.active strong { color: #fff; }
        .truck-btn.active small { color: #bbb; }

        .custom-area { background: #f1f8ff; padding: 8px; border-radius: 4px; border: 1px dashed #aaddff; }
        .input-group { display: flex; align-items: center; gap: 5px; margin-bottom: 4px; font-size: 12px; }
        .btn-apply { width: 100%; background: #3498db; color: white; border: none; padding: 6px; margin-top: 4px; font-size: 12px; }

        .pallet-btn { padding: 8px; text-align: left; display: flex; justify-content: space-between; align-items: center; margin-bottom: 2px; width: 100%; }
        .pallet-btn strong { font-size: 13px; }
        .pallet-btn small { font-size: 10px; color: #666; }

        .action-area { display: flex; gap: 8px; margin-top: 5px; }
        .action-btn { flex: 1; padding: 8px; font-weight: bold; font-size: 12px; }
        .btn-undo { background: #fff0f0; border-color: #ffcccc; color: #c0392b; }
        .btn-clear { background: #fff3cd; border-color: #ffeeba; color: #856404; }

        #status-box { margin-top: auto; padding: 12px; background: #f1f8ff; border: 1px solid #cce5ff; border-radius: 6px; font-size: 12px; }
        .stat-row { display: flex; justify-content: space-between; margin-bottom: 4px; }
        .breakdown { margin-top: 8px; padding-top: 8px; border-top: 1px solid #dae0e5; font-size: 11px; color: #444; line-height: 1.4; }
        .error-msg { color: #e74c3c; font-weight: bold; font-size: 11px; margin-top: 6px; text-align: center; min-height:1em;}

        /* --- è·å°æç”» --- */
        #truck-bed {
            background-color: #f4f4f4; border: 2px solid #333; border-top: 10px solid #2c3e50;
            position: relative; box-shadow: 0 15px 40px rgba(0,0,0,0.3);
            transition: width 0.3s, height 0.3s;
        }
        .bed-header {
            position: absolute; top: -50px; left: 0; width: 100%; text-align: center; pointer-events: none; line-height: 1.4; white-space: nowrap;
        }
        .header-label { font-size: 11px; color: #666; font-weight: bold; display: block; }
        .header-name { font-size: 15px; color: #2c3e50; font-weight: bold; display: block; }

        .pallet {
            position: absolute; box-sizing: border-box; display: flex; justify-content: center; align-items: center;
            font-size: 12px; color: #fff; font-weight: bold; border: 1px solid rgba(0,0,0,0.2);
            box-shadow: inset 0 0 0 1px rgba(255,255,255,0.25); z-index: 10; overflow: hidden;
            white-space: pre-wrap; line-height: 1.1; text-align: center;
        }
        .pallet.type-11 { background-color: #2980b9; } 
        .pallet.type-14 { background-color: #c0392b; }
        .pallet.type-9  { background-color: #f39c12; color: #333; }
        .pallet.type-custom { background-color: #27ae60; } 
        .pallet.preview { opacity: 0.6; border: 2px dashed #333; background-color: rgba(100, 100, 100, 0.5) !important; color: #fff; z-index: 20; pointer-events: none; }

        /* =========================================
           ã‚¹ãƒãƒ›å®Œå…¨å¯¾å¿œ (ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆå¼·åˆ¶æ›¸ãæ›ãˆ)
           ========================================= */
        @media screen and (max-width: 768px) {
            body {
                flex-direction: column; /* ç¸¦ä¸¦ã³ã«å¤‰æ›´ */
                overflow: hidden; /* ãƒœãƒ‡ã‚£è‡ªä½“ã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã¯ç¦æ­¢ */
            }

            /* 1. ä¸Šæ®µï¼šè·å°ã‚¨ãƒªã‚¢ (é«˜ã•45%å›ºå®š) */
            #center-col {
                height: 45%; 
                width: 100%;
                flex: none; /* ä¼¸ç¸®ã•ã›ãªã„ */
                padding: 50px 10px 10px 10px; /* ãƒ˜ãƒƒãƒ€ãƒ¼åˆ†ç¢ºä¿ */
                border-bottom: 1px solid #aaa;
                box-sizing: border-box;
            }

            /* 2. ä¸­æ®µï¼šã‚¿ãƒ–ãƒ¡ãƒ‹ãƒ¥ãƒ¼ (é«˜ã•50pxå›ºå®š) */
            #mobile-tabs {
                display: flex;
                height: 50px;
                width: 100%;
                flex: none;
                background: #eee;
                border-bottom: 1px solid #ccc;
                z-index: 100;
            }
            .tab-btn {
                flex: 1;
                border: none;
                background: #e0e4e8;
                color: #777;
                font-weight: bold;
                font-size: 14px;
                border-bottom: 3px solid transparent;
            }
            .tab-btn.active {
                background: #fff;
                color: #2c3e50;
                border-bottom: 3px solid #2c3e50;
            }

            /* 3. ä¸‹æ®µï¼šæ“ä½œãƒ‘ãƒãƒ« (æ®‹ã‚Šå…¨éƒ¨) */
            #left-col, #right-col {
                display: none; /* ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆéè¡¨ç¤º */
                width: 100% !important;
                min-width: 0 !important;
                flex: 1; /* æ®‹ã‚Šã®é«˜ã•ã‚’åŸ‹ã‚ã‚‹ */
                overflow-y: auto; /* ã“ã“ã ã‘ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã•ã›ã‚‹ */
                padding: 15px;
                box-sizing: border-box;
                border: none;
                background: #fff;
            }

            /* activeã‚¯ãƒ©ã‚¹ãŒã¤ã„ãŸã‚‰è¡¨ç¤º */
            #left-col.active, #right-col.active {
                display: flex;
                flex-direction: column;
            }

            /* PCç”¨ã‚¹ã‚¿ã‚¤ãƒ«ã®ä¸Šæ›¸ããƒªã‚»ãƒƒãƒˆ */
            .mobile-only { display: block; }
        }
    </style>
</head>
<body>

    <div id="mobile-tabs">
        <button class="tab-btn" id="tab-truck" onclick="switchTab('truck')">ğŸš› è·å°è¨­å®š</button>
        <button class="tab-btn active" id="tab-pallet" onclick="switchTab('pallet')">ğŸ“¦ ãƒ‘ãƒ¬ãƒƒãƒˆé…ç½®</button>
    </div>

    <div id="left-col">
        <h2>1. è·å°è¨­å®š</h2>
        <span class="column-header" style="margin-top:0;">å®šå‹ã‚µã‚¤ã‚º</span>
        <div id="truck-buttons"></div>
        <span class="column-header">ã‚«ã‚¹ã‚¿ãƒ  (mm)</span>
        <div class="custom-area">
            <div class="input-group"><label style="flex:1;">é•·ã•(ç¸¦)</label><input type="number" id="custom-truck-l" value="8000" step="100"></div>
            <div class="input-group"><label style="flex:1;">è»Šå¹…(æ¨ª)</label><input type="number" id="custom-truck-w" value="2300" step="10"></div>
            <button class="btn-apply" onclick="setCustomTruck()">é©ç”¨ï¼†ãƒªã‚»ãƒƒãƒˆ</button>
        </div>
        <div style="margin-top:15px; padding:10px; background:#fafafa; border-radius:5px; text-align:center; font-size:12px; color:#666;" class="mobile-only">
            è¨­å®šå¾Œã€ä¸Šã®ã‚¿ãƒ–ã§<br>ã€Œãƒ‘ãƒ¬ãƒƒãƒˆé…ç½®ã€ã¸ç§»å‹•ã—ã¦ãã ã•ã„
        </div>
        <div style="height:50px;"></div>
    </div>

    <div id="center-col">
        <div id="truck-bed" style="display:none;"></div>
    </div>

    <div id="right-col" class="active"> <h2>2. ãƒ‘ãƒ¬ãƒƒãƒˆé…ç½®</h2>
        <span class="column-header" style="margin-top:0;">å®šå‹ãƒ‘ãƒ¬ãƒƒãƒˆ</span>
        <div id="pallet-buttons"></div>
        
        <span class="column-header">ã‚«ã‚¹ã‚¿ãƒ  (mm)</span>
        <div class="custom-area">
            <div class="input-group"><label style="flex:1;">å¹…(æ¨ª)</label><input type="number" id="custom-pallet-w" value="1100" step="10"></div>
            <div class="input-group"><label style="flex:1;">å¥¥è¡Œ(ç¸¦)</label><input type="number" id="custom-pallet-d" value="1100" step="10"></div>
            <button class="btn-apply" id="btn-add-custom" style="background:#27ae60;">ï¼‹ è¿½åŠ </button>
        </div>

        <div class="action-area">
            <button class="action-btn btn-undo" onclick="undoLastPallet()">â†© æˆ»ã‚‹</button>
            <button class="action-btn btn-clear" onclick="clearAll()">âœ– ã‚¯ãƒªã‚¢</button>
        </div>

        <div id="status-box">
            <div class="stat-row"><span>åˆè¨ˆæšæ•°:</span><strong id="count" style="font-size:1.2em;">0 æš</strong></div>
            <div class="stat-row"><span>æ®‹ã‚Šé•·ã• (L/R):</span><span id="remain-len">- / -</span></div>
            <div class="breakdown" id="breakdown-list">(å†…è¨³)</div>
            <div id="error-msg" class="error-msg"></div>
        </div>
        <div style="height:50px;" class="mobile-only"></div>
    </div>

<script>
    // --- ãƒ‡ãƒ¼ã‚¿å®šç¾© ---
    const TRUCKS = [
        { name: "2t æ¨™æº–",    L: 3100, W: 1780 },
        { name: "2t ãƒ¯ã‚¤ãƒ‰L", L: 4310, W: 2095 },
        { name: "4t æ¨™æº–",    L: 5935, W: 2185 },
        { name: "4t ãƒ¯ã‚¤ãƒ‰",  L: 5935, W: 2365 },
        { name: "10t ãƒ¯ã‚¤ãƒ‰", L: 9640, W: 2410 }
    ];

    const PALLETS = [
        { id: '11',  name: "11å‹ æ­£æ–¹å½¢", w: 1100, d: 1100, typeClass: 'type-11' },
        { id: '14v', name: "14å‹ ç¸¦",     w: 1100, d: 1400, typeClass: 'type-14' },
        { id: '14h', name: "14å‹ æ¨ª",     w: 1400, d: 1100, typeClass: 'type-14' },
        { id: '9v',  name: "9å‹ ç¸¦",      w: 900,  d: 1100, typeClass: 'type-9' },
        { id: '9h',  name: "9å‹ æ¨ª",      w: 1100, d: 900,  typeClass: 'type-9' }
    ];

    let currentScale = 0.085; 
    let state = { currentTruck: null, history: [], truckIndex: -1 };

    const dom = {
        centerCol: document.getElementById('center-col'),
        truckBed: document.getElementById('truck-bed'),
        truckBtns: document.getElementById('truck-buttons'),
        palletBtns: document.getElementById('pallet-buttons'),
        count: document.getElementById('count'),
        remainLen: document.getElementById('remain-len'),
        breakdown: document.getElementById('breakdown-list'),
        errorMsg: document.getElementById('error-msg'),
        customTruckL: document.getElementById('custom-truck-l'),
        customTruckW: document.getElementById('custom-truck-w'),
        customPalletW: document.getElementById('custom-pallet-w'),
        customPalletD: document.getElementById('custom-pallet-d'),
        btnAddCustom: document.getElementById('btn-add-custom'),
        leftCol: document.getElementById('left-col'),
        rightCol: document.getElementById('right-col'),
        tabTruck: document.getElementById('tab-truck'),
        tabPallet: document.getElementById('tab-pallet')
    };

    function init() {
        createButtons();
        setupCustomEvents();
        window.addEventListener('resize', onResize);
    }

    function isMobile() {
        return window.innerWidth <= 768;
    }

    function onResize() {
        if(state.currentTruck) {
            calculateAutoScale();
            updateTruckView();
            recalculateAndRender();
        }
    }

    // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆï¼ˆã‚¹ãƒãƒ›ç”¨ï¼‰
    window.switchTab = function(target) {
        if (target === 'truck') {
            dom.leftCol.classList.add('active');
            dom.rightCol.classList.remove('active');
            dom.tabTruck.classList.add('active');
            dom.tabPallet.classList.remove('active');
        } else {
            dom.leftCol.classList.remove('active');
            dom.rightCol.classList.add('active');
            dom.tabTruck.classList.remove('active');
            dom.tabPallet.classList.add('active');
        }
        setTimeout(onResize, 50); // ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆå¤‰æ›´å¾Œã®å†è¨ˆç®—
    };

    function createButtons() {
        TRUCKS.forEach((t, i) => {
            const btn = document.createElement('button');
            btn.className = 'truck-btn';
            btn.innerHTML = `<strong>${t.name}</strong><small>${t.L}Ã—${t.W}</small>`;
            btn.onclick = () => selectTruck(i, btn);
            dom.truckBtns.appendChild(btn);
        });

        PALLETS.forEach(p => {
            const btn = document.createElement('button');
            btn.className = 'pallet-btn';
            btn.innerHTML = `<strong>${p.name}</strong><small>${p.w}Ã—${p.d}</small>`;
            
            btn.onclick = () => addPalletRequest(p);
            btn.onmouseenter = () => { if(!isMobile()) showPreview(p); };
            btn.onmouseleave = () => hidePreview();

            dom.palletBtns.appendChild(btn);
        });
    }

    function setupCustomEvents() {
        dom.btnAddCustom.onclick = () => {
            const w = parseInt(dom.customPalletW.value) || 0;
            const d = parseInt(dom.customPalletD.value) || 0;
            if (w <= 0 || d <= 0) return;
            const p = { id: 'custom', name: `ã‚«ã‚¹ã‚¿ãƒ (${w}x${d})`, w: w, d: d, typeClass: 'type-custom' };
            addPalletRequest(p);
            if(!isMobile()) showPreview(p);
        };
        dom.btnAddCustom.onmouseenter = () => {
            if(isMobile()) return; 
            const w = parseInt(dom.customPalletW.value) || 0;
            const d = parseInt(dom.customPalletD.value) || 0;
            if (w > 0 && d > 0) {
                const p = { id:'custom', name:'Custom', w:w, d:d, typeClass:'type-custom' };
                showPreview(p);
            }
        };
        dom.btnAddCustom.onmouseleave = () => hidePreview();
    }

    function calculateAutoScale() {
        if (!state.currentTruck) return;
        
        // PCã¨ã‚¹ãƒãƒ›ã§ä½™ç™½è¨ˆç®—ã‚’å¤‰ãˆã‚‹
        // PC: header(60)+padding(20)=80, widthPadding=40
        // Mobile: header(50)+padding(10)=60, widthPadding=20
        const paddingH = isMobile() ? 60 : 80; 
        const paddingW = isMobile() ? 20 : 40;

        const containerH = dom.centerCol.clientHeight - paddingH;
        const containerW = dom.centerCol.clientWidth - paddingW;
        
        // åˆ†æ¯ãŒ0ã«ãªã‚‰ãªã„ã‚ˆã†ã‚¬ãƒ¼ãƒ‰
        if(containerH <= 0 || containerW <= 0) return;

        const scaleH = containerH / state.currentTruck.L;
        const scaleW = containerW / state.currentTruck.W;
        currentScale = Math.min(scaleH, scaleW);
    }

    function selectTruck(index, btnElem) {
        state.currentTruck = TRUCKS[index];
        state.truckIndex = index;
        
        clearAllLogic(); 
        Array.from(dom.truckBtns.children).forEach(b => b.classList.remove('active'));
        if(btnElem) btnElem.classList.add('active');

        // ã‚¹ãƒãƒ›ãªã‚‰è‡ªå‹•ã§ãƒ‘ãƒ¬ãƒƒãƒˆã‚¿ãƒ–ã¸èª˜å°
        if(isMobile()) switchTab('pallet');
        
        setTimeout(() => {
            calculateAutoScale();
            updateTruckView();
        }, 50);
    }

    function setCustomTruck() {
        const L = parseInt(dom.customTruckL.value);
        const W = parseInt(dom.customTruckW.value);
        if (!L || !W || L<=0 || W<=0) { showError("ã‚µã‚¤ã‚ºNG"); return; }

        state.currentTruck = { name: "ã‚«ã‚¹ã‚¿ãƒ è·å°", L: L, W: W };
        state.truckIndex = -1;
        
        clearAllLogic();
        Array.from(dom.truckBtns.children).forEach(b => b.classList.remove('active'));
        
        if(isMobile()) switchTab('pallet');

        setTimeout(() => {
            calculateAutoScale();
            updateTruckView();
        }, 50);
    }

    function addPalletRequest(palletProto) {
        if (!state.currentTruck) { 
            if(isMobile()) {
                showError("â—€ è·å°ã‚¿ãƒ–ã§è·å°ã‚’é¸ã‚“ã§ãã ã•ã„");
                switchTab('truck');
            } else {
                showError("â—€ è·å°ã‚’é¸æŠã—ã¦ãã ã•ã„");
            }
            return; 
        }
        const newHistory = [...state.history, palletProto];
        const result = calculateLayout(state.currentTruck, newHistory);

        if (result.success) {
            state.history = newHistory;
            renderResult(result);
            showError("");
        } else {
            showError("é•·ã•ã‚ªãƒ¼ãƒãƒ¼ã§ã™");
        }
    }

    function undoLastPallet() {
        if (state.history.length === 0) return;
        state.history.pop();
        recalculateAndRender();
        showError("");
    }

    function clearAll() {
        if (!state.currentTruck) return;
        clearAllLogic();
    }

    function clearAllLogic() {
        state.history = [];
        recalculateAndRender();
        showError("");
    }

    function calculateLayout(truck, palletList) {
        let placedItems = [];
        let leftY = 0;
        let rightY = 0;

        for (let i = 0; i < palletList.length; i++) {
            const p = palletList[i];
            let x, y;

            if (p.w * 2 <= truck.W) {
                if (leftY <= rightY) {
                    x = 0; y = leftY;
                    if (y + p.d > truck.L) return { success: false };
                    leftY += p.d;
                } else {
                    x = truck.W - p.w; y = rightY;
                    if (y + p.d > truck.L) return { success: false };
                    rightY += p.d;
                }
            } else {
                let startY = Math.max(leftY, rightY);
                y = startY;
                x = (truck.W - p.w) / 2;
                if (y + p.d > truck.L) return { success: false };
                leftY = y + p.d;
                rightY = y + p.d;
            }

            placedItems.push({ 
                x: x, y: y, w: p.w, d: p.d, 
                name: p.name, typeClass: p.typeClass, index: i + 1 
            });
        }
        return { success: true, items: placedItems, usedLength: Math.max(leftY, rightY), leftY: leftY, rightY: rightY };
    }

    function showPreview(pallet) {
        if (!state.currentTruck) return;
        const previewHistory = [...state.history, pallet];
        const result = calculateLayout(state.currentTruck, previewHistory);
        hidePreview();

        if (result.success) {
            const item = result.items[result.items.length - 1];
            const el = document.createElement('div');
            el.id = 'preview-ghost';
            el.className = `pallet preview`;
            el.style.left = (item.x * currentScale) + 'px';
            el.style.top  = (item.y * currentScale) + 'px';
            el.style.width = (item.w * currentScale) + 'px';
            el.style.height = (item.d * currentScale) + 'px';
            el.innerHTML = "NEXT";
            dom.truckBed.appendChild(el);
        }
    }

    function hidePreview() {
        const ghost = document.getElementById('preview-ghost');
        if (ghost) ghost.remove();
    }

    function recalculateAndRender() {
        hidePreview();
        if (!state.currentTruck) {
             dom.truckBed.innerHTML = '';
             dom.count.textContent = '0 æš';
             dom.remainLen.textContent = '- / -';
             dom.breakdown.innerHTML = '(å†…è¨³)';
             return;
        }
        const result = calculateLayout(state.currentTruck, state.history);
        renderResult(result);
    }

    function updateTruckView() {
        if(!state.currentTruck) return;
        dom.truckBed.style.display = 'block';
        dom.truckBed.style.width = (state.currentTruck.W * currentScale) + 'px';
        dom.truckBed.style.height = (state.currentTruck.L * currentScale) + 'px';
    }

    function renderResult(result) {
        dom.truckBed.innerHTML = '';
        
        if(state.currentTruck) {
            const header = document.createElement('div');
            header.className = 'bed-header';
            header.innerHTML = `<span class="header-label">é‹è»¢å¸­å´ (å¥¥)</span><span class="header-name">${state.currentTruck.name} (${state.currentTruck.L}Ã—${state.currentTruck.W})</span>`;
            dom.truckBed.appendChild(header);
        }

        const items = result.items || [];
        items.forEach(item => {
            const el = document.createElement('div');
            el.className = `pallet ${item.typeClass}`;
            el.style.left = (item.x * currentScale) + 'px';
            el.style.top  = (item.y * currentScale) + 'px';
            el.style.width = (item.w * currentScale) + 'px';
            el.style.height = (item.d * currentScale) + 'px';
            el.innerHTML = `<span style="display:block; text-align:center;">${item.index}<br><span style="font-size:10px; opacity:0.8;">${item.w}x${item.d}</span></span>`;
            dom.truckBed.appendChild(el);
        });

        dom.count.textContent = items.length + " æš";
        if(state.currentTruck) {
            const remL = Math.max(0, state.currentTruck.L - (result.leftY || 0));
            const remR = Math.max(0, state.currentTruck.L - (result.rightY || 0));
            dom.remainLen.textContent = `L:${remL} / R:${remR}`;
        }

        if (items.length === 0) {
            dom.breakdown.innerHTML = "ãƒ‘ãƒ¬ãƒƒãƒˆãªã—";
        } else {
            const counts = {};
            items.forEach(item => { const n = item.name; counts[n] = (counts[n] || 0) + 1; });
            let html = [];
            for (const [name, num] of Object.entries(counts)) {
                html.push(`<div>${name}: <strong>${num}</strong></div>`);
            }
            dom.breakdown.innerHTML = html.join("");
        }
    }

    function showError(msg) {
        dom.errorMsg.textContent = msg;
    }

    init();
</script>

</body>
</html>